<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta charset="utf-8" />
  <meta name="description" content="">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

  <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/static/css/font-awesome.min.css" />
  <link rel="stylesheet" href="/static/css/ace-fonts.css" />
  <link rel="stylesheet" href="/static/css/ace.min.css" id="main-ace-style" />
  <link rel="stylesheet" href="/static/css/layout.css">

  <!--[if lte IE 9]>
    <link rel="stylesheet" href="/static/css/ace-part2.min.css" />
  <![endif]-->

  <!--[if lte IE 9]>
    <link rel="stylesheet" href="/static/css/ace-ie.min.css" />
  <![endif]-->

  <!--[if lte IE 8]>
  <script src="/static/js/html5shiv.js"></script>
  <script src="/static/js/respond.min.js"></script>
  <![endif]-->

  <style type="text/css">
    .page-content {
      padding: 0px 12px 0px 12px;
    }
    .widget-box {
      margin: 0px 0px 2px 0px !important;
    }
    .widget-header {
      padding-left: 0px !important;
    }
    .widget-toolbar {
      padding-left: 0px !important;
    }
    .widget-toolbar button {
      width: 80px;
    }
    .modal-content{
      border-color: #5090c1;
    }
    .modal-header {
      background: #5090c1;
      padding-top: 10px;
      padding-bottom: 10px;
    }
    .modal-header h4 {
      color: #fff
    }
    .modal-body {
      background-color: #f2f6f9;
    }
    .form-group select {
			padding-left: 0px;
    }
  </style>

</head>

<body class="no-skin">
  <div class="main-container" id="main-container">

      <div class="page-content">
        <div class="page-content-area">
          <div class="row">

            <div class="widget-box transparent collapsed">
              <div class="widget-header ">
                
                <div class="widget-toolbar no-border pull-left">
                  <button class="btn btn-xs bigger btn-warning" data-toggle="modal" data-backdrop="false" data-target="#modalInfo">
										<i class="ace-icon fa fa-plus"></i> 添加
									</button>
                </div>
                
                <h4 class="widget-title lighter pull-left">
									页面设置 <small></small>
								</h4>
                
              </div>

            </div>
            
            <div class="content" id="div_data">
              <table id="datalist" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<th>pagename</th>
										<th>url</th>
										<th>ordernum</th>
										<th>isnav</th>
										<th>remark</th>
										<th>操作</th>
									</tr>
								</thead>
							</table>
            </div>
            
            <div class="alert alert-warning hide" id="div_nodata">没有找到您需要的数据</div>

          </div>
        </div>

    </div>
    
    
		<div class="modal fade" id="modalInfo" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4 class="modal-title" id="modalLabel">PAGE SETTING</h4>
					</div>
					<div class="modal-body">
						<form id="form1" class="form-horizontal">
							<div class="row">
								<input type="hidden" value="" id="page_id" name="page_id">
								<div class="form-group col-md-12">
									<label class="col-md-2 control-label no-padding-right" for="pagecategory">pagecategory：</label>
									<div class="col-md-9">
										<div class="clearfix">
											<select class="col-sm-12" id="pagecategory" name="pagecategory">
												<option value=1>pagetype1</option>
												<option value=2>pagetype2</option>
											</select>
										</div>
									</div>
								</div>
								<div class="form-group col-md-12">
									<label class="col-md-2 control-label no-padding-right" for="pagename">pagename：</label>
									<div class="col-md-9">
										<input type="text" class="col-sm-12" id="pagename" name="pagename">
									</div>
								</div>
								<div class="form-group col-md-12">
									<label class="col-md-2 control-label no-padding-right" for="url">URL：</label>
									<div class="col-md-9">
										<input type="text" class="col-sm-12" id="url" name="url">
									</div>
								</div>
								<div class="form-group col-md-12">
									<label class="col-md-2 control-label no-padding-right" for="ordernum">ordernum：</label>
									<div class="col-md-9">
										<input type="text" class="col-sm-12" id="ordernum" name="ordernum">
									</div>
								</div>
								<div class="form-group col-md-12">
									<label class="col-md-2 control-label no-padding-right" for="isnav">isnav：</label>
									<div class="col-md-9">
										<select class="col-sm-12" id="isnav" name="isnav">
											<option value=1>YES</option>
											<option value=0>NO</option>
										</select>
									</div>
								</div>
								<div class="form-group col-md-12">
									<label class="col-md-2 control-label no-padding-right" for="remark">remark：</label>
									<div class="col-md-9">
										<input type="text" class="col-sm-12" id="remark" name="remark">
									</div>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default btn-sm" data-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-primary btn-sm" id="btn_save">保存更改</button>
					</div>
				</div>
			</div>
		</div>

  </div>

  <!--[if !IE]> -->
  <script type="text/javascript">
    window.jQuery || document.write("<script src='/static/js/jquery.min.js'>"+"<"+"/script>");
  </script>

  <!-- <![endif]-->

  <!--[if IE]>
  <script type="text/javascript">
   window.jQuery || document.write("<script src='/static/js/jquery1x.min.js'>"+"<"+"/script>");
  </script>
  <![endif]-->
  <script type="text/javascript">
    if('ontouchstart' in document.documentElement) document.write("<script src='/static/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
  </script>
  <script src="/static/js/bootstrap.min.js"></script>
  <script src="/static/js/ace.min.js"></script>
  <script src="/static/js/jquery.drag.js"></script>
  <script src="/static/js/jquery.dataTables.min.js"></script>
  <script src="/static/js/jquery.dataTables.bootstrap.js"></script>
	<script src="/static/js/jquery.validate.js"></script>
	<script src="/static/js/jquery.form.js"></script>
  <script type="text/javascript">
     jQuery.extend(jQuery.fn.dataTable.defaults, {
      searching: false,
      ordering: false,
      orderClasses: false,
      retrieve: true,
      lengthChange: true,
      pageLength: 15,
      lengthMenu: [[10, 15, 30, 50], [10, 15, 30, 50]],
      scrollY: "100%",
      scrollCollapse: true,
      language: {
        paginate: {
          first: "<<",
          last: ">>",
          next: ">",
          previous: "<"
        },
        info: "&nbsp;共 _TOTAL_ 条记录",
        lengthMenu: "_MENU_ 条/页",
        infoEmpty: "没有记录",
        emptyTable: "no data"
      }
    });

		var table = undefined;
		var _data = (function($){
			var obj = {}

			obj.initTable = function(table_name){
				return jQuery("#" + table_name).dataTable({
					processing: true,
					serverSide: true,
					ajax: {
						url: "../handler/pages.ashx?action=load",
						type: "POST"
					},
					columns: [
						{ data: "Page_name" },
						{ data: "Url" },
						{ data: "Ordernum" },
						{ data: "Isnav" },
						{ data: "Remark" },
						{ data: "Id_Ex" },
					],
					columnDefs:[
						{
							targets: 5,
							width: "70px",
							className: "col-action col-center",
							render: function(data,type,row){
								return "<div class='btn-group'>"+
											 " <button data-toggle='dropdown' class='btn btn-sm btn-default btn-white dropdown-toggle'>"+
											 "   操作 <span class='ace-icon fa fa-caret-down icon-on-right'></span>"+
											 " </button>"+
											 " <ul class='dropdown-menu dropdown-info dropdown-menu-right'>"+
											 "   <li><a href='#' data='"+data+"'' data-toggle='modal' data-backdrop='false' data-target='#modalInfo'>编辑</a></li>"+
											 "   <li class='divider'></li>"+
											 "   <li><a href='page_permissions.aspx?pageid="+data+"'>设置页面权限</a></li>"+
											 " </ul>"+
											 "</div>"
							}
						}
					],
					initComplete: function () {
						$('div.dataTables_scrollBody').css('overflow',"inherit");
					},
					drawCallback: function() {
						var api = this.api();
						if(api.ajax.json().recordsTotal == 0){
							$("#div_data").addClass("hide");
							$("#div_nodata").removeClass("hide");
						}
						else{
							$("#div_data").removeClass("hide");
							$("#div_nodata").addClass("hide");
						}
					}
				})
			}

			return obj;

		}(window.jQuery)) || {};

		var post_options = {
			url: "../handler/pages.ashx?action=save",
			dataType: "json",
			type: "post",
			clearForm: true,
			beforeSubmit: function(){
				return $('#form1').valid()
			},
			success: function(response, status){
				if(response.StatusCode==200){
					$("#modalInfo").modal("hide");
					var api = table.api();
					api.ajax.reload();
				}
			}
		}

		jQuery(function($) {
			$('.modal').drags({ handle: '.modal-header' });
			
			$('#modalInfo').on('show.bs.modal', function(e) {
				$("#form1 input").val("");
				data = $(e.relatedTarget).attr("data");
				if (data != undefined) {
					jQuery.getJSON("../handler/pages.ashx?action=info&id=" + data, function(response) {
						$("#page_id").val(response.Data.Id_Ex);
						$("#pagecategory").val(response.Data.Category_id);
						$("#pagename").val(response.Data.Page_name);
						$("#url").val(response.Data.Url);
						$("#ordernum").val(response.Data.Ordernum);
						$("#isnav").val(response.Data.Isnav);
						$("#remark").val(response.Data.Remark);
					})
				}
			})

			$("#btn_save").click(function() {
				$("#form1").ajaxSubmit(post_options);
				return false;
			})

			$('#form1').validate({
				errorElement: 'div',
				errorClass: 'help-block',
				focusInvalid: false,
				rules: {
					pagename: { required: true },
					url: { required: true }
				},
				messages: {
					pagename: "请输入pagename",
					url: "请输入url"
				},
				highlight: function(e) {
					$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
				},
				success: function(e) {
					$(e).closest('.form-group').removeClass('has-error');
					$(e).remove();
				}
			});


			table = _data.initTable("datalist");
		})
  </script>
</body>
</html>
